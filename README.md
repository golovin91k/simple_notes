# SIMPLE NOTES
![example workflow](https://github.com/golovin91k/simple_notes/workflows/Main%20simple%20notes%20bot%20workflow/badge.svg)

> Проект придуман и разработан лично мной.
Не является учебным, взятым с каких-либо курсов разработчиков.

## Описание проекта
**SIMPLE NOTES** - телеграм-бот, позволяющий пользователям создавать и хранить текстовые заметки в телеграмм.

Бот дает возможности:
- создавать до пяти категорий для управления заметками
- закрепить до семи заметок

Бот использует технологию **Telegram Mini Apps** для удобства создания и отображения заметок.
**Ссылка на запущенный проект** - https://t.me/simple_notes_g91k_bot

## Технологии проекта
В проекте используются следующие технологии:


| Backend:     | Frontend:    | Deploy:        |
| :------------| :------------| :--------------|
| FastApi      | HTML         | GitHub Actions |
| Aiogram      | CSS          | Docker         |
| PostgreSQL   | Javascript   | Nginx          |
| SQLAlchemy   |              |                |
| Alembic      |              |                |

Для получения более подробной информации об использованных библиотеках смотри файл src/requirements.txt
## Структура и работа проекта

В проекте имеются три таблицы моделей БД:
- **User** (Пользователи)
- **Category** (Категории)
- **Note** (Заметки)

### Порядок создания нового пользователя и назначение токена пользователя
Новый пользователь создается при нажатии кнопки *старт* или ввода */start* в чате бота.

У модели **User** есть следующие поля:
- telegram_id: int
- token: str
- is_active: bool
- is_admin: bool

Создание пользователя осуществляется путем вызова метода *create()* экземпляра *user_crud* класса *CRUDUser* *(смотри файл src / app/ crud / base.py и user.py)*.

В метод *create()* передается словарь с данными о пользователе:
- telegram_id - телеграм айди пользователя, который извлекается из сообщения пользователя */start*
- is_active - для всех пользователей значение *True*. Поле необходимо, чтобы была возможность админу заблокировать доступ пользователя к боту, изменяя значение поля is_active на *False*.
- is_admin - для всех пользователей значение *False*, а для админа значение *True*.

##### Как генерируется и для чего нужно поле *token* ?
Поле *token* генерируется при создании нового пользователя при вызове метода *create()*. Поле является уникальным и проверяется на уникальность при генерации.

Поле *token* используется для аутентификации пользователя и предоставления пользователю доступа к функционалу миниапп бота.

Так как *token* передается через url-параметры при переходах между страницами миниапп, то для безопасности *token* предварительно шифруется с использованием библиотеки Crypto.Cipher *(смотри файл src / app / token_encryption.py)*

Для проверки доступа пользователя перед загрузкой страницы миниапп отрабатывает декоратор *@check_permissions*, который получает *user_id* и *user_token* из query параметров url.
Затем декоратор дешифрует *user_token* и сверяет *user_id* и *user_token* с информацией из БД.
Если пары совпадают, то доступ предоставляется и загружается страница миниапп, в ином случае - отображается ошибка *(смотри файл src / app / api / user_router_api.py)*.

### Интерфейс
...


### Категории
У модели **Category** есть следующие поля:
- title: str
- user_id: int (id записи пользователя в таблице User)

У одного пользователя (поле *user_id*) не может быть двух категорий с одинаковым названием (поле *title*).

Сразу после создания нового пользователя для него создается категория заметок по умолчанию с названием *Без категории* *(смотри файл src / app / bot / handlers / user_router_bot.py)*.
В эту категорию добавляются заметки пользователя, у которых при создании или редактировании не выбрана категория.

Также пользователь, используя функционал миниапп, может создать еще четыре категории заметок.

До создания новой категории проверяется введенное пользователем название категории (поле *title*) с помощью **схем Pydantic** (*смотри файл src / app / schemas / category.py*).
При проверке поля title не допускается:
- чтобы поле состояло только из пробелов или было пустым
- чтобы поле дублировало название категории по умолчанию - "Без категории"

В роутере */successful_category_creation* проводится проверка на дубляж введенного названия категории.
Аналогичные проверки проводятся и при переименовании категории пользователем.
В случае, если название категории не проходит проверки, то пользователю отображается страница с выявленной ошибкой.

Создание новой категории осуществляется путем вызова метода *create()* экземпляра *category_crud* класса *CRUDCategory*, а переименование категории - путем вызова метода *update()*. (смотри файлы src / app/ crud / base.py и  category.py)*.

### Заметки
У модели **Note** есть следующие поля:
- title: str
- text: str
- is_pinned: bool
- user_id: int (id записи пользователя в таблице User)
- category_id: int (id записи категории в таблице Category)

Пользователь при помощи миниапп может создать неограниченное количество заметок.
Для создания заметки пользователь должен ввести её название, текст, а также выбрать категорию заметок.
В случае если пользователь не выбрал категорию для заметки, то заметка будет добавлена в категорию по умолчанию *Без категории*.
Также пользователь может закрепить заметку, поставив галочку рядом с надписью "Закрепить заметку".

До создания новой заметки проверяются введенные пользователем данные: название заметки (поле *title*) и текст заметки (поле *text*) с помощью **схем Pydantic** (*смотри файл src / app / schemas / note.py*).
При проверке полей не допускается, чтобы они состояли только из пробелов или были пустыми.

Описание будет дополняться

Автор проекта - Головин Кирилл
e-mail: golovin91k@gmail.com
tg: https://t.me/golovin91k